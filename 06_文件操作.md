# C++ æ–‡ä»¶æ“ä½œç¬”è®°

> ç”¨"æµ"çš„æ¦‚å¿µå¤„ç†æ–‡ä»¶ï¼Œæ•°æ®åƒæ°´æµä¸€æ ·æµåŠ¨

---

## ä¸€ã€åŸºç¡€æ¦‚å¿µ

### 1.1 å¤´æ–‡ä»¶

```cpp
#include <fstream>
```

### 1.2 ä¸‰ç§æ–‡ä»¶æµå¯¹è±¡

| ç±»å‹ | ç”¨é€” |
|------|------|
| `ofstream` | å†™æ–‡ä»¶ï¼ˆoutput file streamï¼‰|
| `ifstream` | è¯»æ–‡ä»¶ï¼ˆinput file streamï¼‰|
| `fstream` | è¯»å†™éƒ½å¯ä»¥ |

---

## äºŒã€å†™æ–‡ä»¶

```cpp
#include <iostream>
#include <fstream>
using namespace std;

int main() {
    // 1. åˆ›å»ºè¾“å‡ºæµå¯¹è±¡ï¼Œæ‰“å¼€æ–‡ä»¶
    ofstream outFile("test.txt");
    
    // 2. å†™å…¥å†…å®¹ï¼ˆå’Œ cout ç”¨æ³•ä¸€æ ·ï¼‰
    outFile << "ä½ å¥½ï¼Œä¸–ç•Œï¼" << endl;
    outFile << "æ•°å­—ï¼š" << 123 << endl;
    
    // 3. å…³é—­æ–‡ä»¶
    outFile.close();
    
    return 0;
}
```

---

## ä¸‰ã€è¯»æ–‡ä»¶

```cpp
#include <iostream>
#include <fstream>
#include <string>
using namespace std;

int main() {
    ifstream inFile("test.txt");
    
    // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ‰“å¼€æˆåŠŸ
    if (!inFile) {
        cout << "æ–‡ä»¶æ‰“å¼€å¤±è´¥ï¼" << endl;
        return 1;
    }
    
    // é€è¡Œè¯»å–
    string line;
    while (getline(inFile, line)) {
        cout << line << endl;
    }
    
    inFile.close();
    return 0;
}
```

---

## å››ã€ç†è§£ ifstream å’Œ ofstream çš„å‘½å

### ğŸ“Œ å…³é”®ï¼šè¯»/å†™è¯´çš„æ˜¯å¯¹æ–‡ä»¶çš„æ“ä½œï¼Œä¸æ˜¯å¯¹ç¨‹åºçš„æ“ä½œ

**ç”Ÿæ´»æ¯”å–»ï¼šæŠŠæ–‡ä»¶æƒ³è±¡æˆä¸€æœ¬ä¹¦**

| åŠ¨ä½œ | ä½ åœ¨åšä»€ä¹ˆ | æ•°æ®æµå‘ |
|-----|----------|---------|
| è¯»ä¹¦ | çœ¼ç›ä»ä¹¦ä¸Šè·å–å†…å®¹ | ä¹¦ â†’ ä½ çš„å¤§è„‘ |
| å†™ä¹¦ | ç¬”æŠŠå†…å®¹å†™åˆ°ä¹¦ä¸Š | ä½ çš„å¤§è„‘ â†’ ä¹¦ |

**å¯¹åº”åˆ°ç¨‹åºï¼š**

| åŠ¨ä½œ | ç¨‹åºåœ¨åšä»€ä¹ˆ | æ•°æ®æµå‘ |
|-----|------------|---------|
| è¯»æ–‡ä»¶ | ç¨‹åºä»æ–‡ä»¶è·å–å†…å®¹ | æ–‡ä»¶ â†’ ç¨‹åºï¼ˆæµå…¥ï¼‰|
| å†™æ–‡ä»¶ | ç¨‹åºæŠŠå†…å®¹å†™åˆ°æ–‡ä»¶ | ç¨‹åº â†’ æ–‡ä»¶ï¼ˆæµå‡ºï¼‰|

**è®°å¿†æ–¹å¼ï¼š**

```
è¯»æ–‡ä»¶ â†’ æ–‡ä»¶å†…å®¹åˆ°ç¨‹åº â†’ ifstream (in)
å†™æ–‡ä»¶ â†’ ç¨‹åºå†…å®¹åˆ°æ–‡ä»¶ â†’ ofstream (out)
```

---

## äº”ã€`>>` æ“ä½œç¬¦çš„å·¥ä½œåŸç†

### 5.1 ç±»å‹ç”±å˜é‡å†³å®š

`>>` æ ¹æ®å˜é‡ç±»å‹æ¥è§£ææ•°æ®ï¼Œä¸æ˜¯æ–‡ä»¶è‡ªåŠ¨åˆ†è¾¨ï¼š

```cpp
// æ–‡ä»¶å†…å®¹ï¼šå¼ ä¸‰ 85
string name;
int score;

inFile >> name >> score;
// name æ˜¯ stringï¼Œè¯»åˆ°ç©ºæ ¼åœï¼Œå¾—åˆ° "å¼ ä¸‰"
// score æ˜¯ intï¼ŒæŠŠ "85" è½¬æˆæ•°å­— 85
```

### 5.2 æ£€æŸ¥è¯»å–æ˜¯å¦æˆåŠŸ

`>>` è¿”å›æµå¯¹è±¡ï¼Œå¯å½“å¸ƒå°”å€¼ä½¿ç”¨ï¼š
- è¯»å–æˆåŠŸ â†’ true
- è¯»å–å¤±è´¥ â†’ false

```cpp
int num;
if (inFile >> num) {
    cout << "æˆåŠŸï¼š" << num << endl;
} else {
    cout << "å¤±è´¥ï¼" << endl;
    inFile.clear();  // æ¸…é™¤é”™è¯¯çŠ¶æ€ï¼Œå¦åˆ™åç»­è¯»å–éƒ½ä¼šå¤±è´¥
}
```

### 5.3 `>>` å’Œ `getline` çš„åŒºåˆ«

| æ–¹å¼ | é‡åˆ°ä»€ä¹ˆåœæ­¢ | é€‚åˆè¯»å– |
|------|-------------|---------|
| `inFile >> str` | ç©ºæ ¼ã€æ¢è¡Œ | å•ä¸ªå•è¯ |
| `getline(inFile, str)` | æ¢è¡Œ | æ•´è¡Œå†…å®¹ |

```
æ–‡ä»¶å†…å®¹ï¼š  "Hello World 123"

inFile >> s1  â†’  s1 = "Hello"ï¼ˆé‡åˆ°ç©ºæ ¼åœï¼‰
inFile >> s2  â†’  s2 = "World"ï¼ˆé‡åˆ°ç©ºæ ¼åœï¼‰
inFile >> s3  â†’  s3 = "123"

getline(inFile, line)  â†’  line = "Hello World 123"ï¼ˆæ•´è¡Œï¼‰
```

---

## å…­ã€æ··ç”¨ `>>` å’Œ `getline` çš„é—®é¢˜

### 6.1 é—®é¢˜ï¼šè¯»å–"é”™ä½"

```cpp
// æ–‡ä»¶å†…å®¹ï¼š
// Hello World
// ç¬¬äºŒè¡Œ

int num;
inFile >> num;      // å¤±è´¥
inFile.clear();
string word;
inFile >> word;     // è¯»åˆ° "Hello"ï¼ŒæŒ‡é’ˆåœ¨ç©ºæ ¼å¤„

string line;
getline(inFile, line);  // è¯»åˆ° " World"ï¼Œä¸æ˜¯å®Œæ•´çš„ç¬¬äºŒè¡Œï¼
```

### 6.2 è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆ1ï¼šå›åˆ°æ–‡ä»¶å¼€å¤´**

```cpp
inFile.clear();
inFile.seekg(0);  // æŒ‡é’ˆå›åˆ°å¼€å¤´
```

**æ–¹æ¡ˆ2ï¼ˆæ¨èï¼‰ï¼šä¸è¦æ··ç”¨ï¼Œåªç”¨ä¸€ç§æ–¹å¼è¯»å–**

---

## ä¸ƒã€æ–‡ä»¶æ‰“å¼€æ¨¡å¼

### 7.1 é»˜è®¤æ¨¡å¼ä¼šè¦†ç›–æ–‡ä»¶

```cpp
ofstream outFile("test.txt");  // æ¯æ¬¡è¿è¡Œéƒ½ä¼šæ¸…ç©ºåŸå†…å®¹
```

### 7.2 è¿½åŠ æ¨¡å¼

```cpp
ofstream outFile("test.txt", ios::app);  // åœ¨æœ«å°¾æ·»åŠ ï¼Œä¸è¦†ç›–
```

### 7.3 å¸¸ç”¨æ¨¡å¼

| æ¨¡å¼ | å«ä¹‰ |
|------|------|
| `ios::out` | å†™å…¥ï¼ˆé»˜è®¤ï¼Œä¼šè¦†ç›–ï¼‰|
| `ios::app` | è¿½åŠ  |
| `ios::in` | è¯»å– |
| `ios::trunc` | æ¸…ç©ºæ–‡ä»¶ |

æ¨¡å¼å¯ç»„åˆï¼š

```cpp
fstream file("data.txt", ios::in | ios::out);
```

---

## å…«ã€æ–‡ä»¶æ“ä½œ + å®¹å™¨

### 8.1 map + æ–‡ä»¶

```cpp
#include <iostream>
#include <fstream>
#include <map>
#include <string>
using namespace std;

int main() {
    map<string, int> scores;
    
    // å†™å…¥
    scores["å¼ ä¸‰"] = 85;
    scores["æå››"] = 92;
    
    ofstream outFile("data.txt");
    for (auto& p : scores) {
        outFile << p.first << " " << p.second << endl;
    }
    outFile.close();
    
    // è¯»å–
    map<string, int> loaded;
    ifstream inFile("data.txt");
    string name;
    int score;
    while (inFile >> name >> score) {
        loaded[name] = score;
    }
    inFile.close();
    
    return 0;
}
```

### 8.2 list + æ–‡ä»¶

```cpp
#include <iostream>
#include <fstream>
#include <list>
#include <string>
using namespace std;

int main() {
    list<string> names;
    
    // å†™å…¥
    names.push_back("å¼ ä¸‰");
    names.push_back("æå››");
    
    ofstream outFile("list.txt");
    for (auto& n : names) {
        outFile << n << endl;
    }
    outFile.close();
    
    // è¯»å–
    list<string> loaded;
    ifstream inFile("list.txt");
    string line;
    while (getline(inFile, line)) {
        loaded.push_back(line);
    }
    inFile.close();
    
    return 0;
}
```

### 8.3 ğŸ“Œ æ ¸å¿ƒæ¨¡å¼

```cpp
// å†™å…¥å®¹å™¨åˆ°æ–‡ä»¶
for (auto& item : å®¹å™¨) {
    outFile << item << endl;
}

// ä»æ–‡ä»¶è¯»å–åˆ°å®¹å™¨
while (è¯»å–æ–¹å¼) {
    å®¹å™¨.push_back(item);  // æˆ– å®¹å™¨[key] = value;
}
```

---

## ä¹ã€èŒƒå›´ for å¾ªç¯

### 9.1 è¯­æ³•

```cpp
for (ç±»å‹ å˜é‡å : å®¹å™¨) {
    // ä½¿ç”¨å˜é‡å
}
```

**è§„åˆ™ï¼šå®¹å™¨é‡Œè£…ä»€ä¹ˆç±»å‹ï¼Œå˜é‡å°±æ˜¯ä»€ä¹ˆç±»å‹**

### 9.2 å„å®¹å™¨ç¤ºä¾‹

```cpp
// vector<int>
vector<int> nums = {1, 2, 3};
for (auto& n : nums) {
    cout << n << endl;
}

// list<string>
list<string> names = {"å¼ ä¸‰", "æå››"};
for (auto& name : names) {
    cout << name << endl;
}

// map<string, int>ï¼ˆå…ƒç´ æ˜¯ pairï¼‰
map<string, int> scores;
for (auto& p : scores) {
    cout << p.first << " " << p.second << endl;
}

// æ•°ç»„
int arr[] = {10, 20, 30};
for (auto& x : arr) {
    cout << x << endl;
}
```

### 9.3 åŠ  `&` çš„åŒºåˆ«

```cpp
// ä¸åŠ  &ï¼šå¤åˆ¶ï¼Œä¿®æ”¹ä¸å½±å“åŸæ•°æ®
for (auto n : nums) { n = 100; }  // nums ä¸å˜

// åŠ  &ï¼šå¼•ç”¨ï¼Œä¿®æ”¹å½±å“åŸæ•°æ®
for (auto& n : nums) { n = 100; }  // nums å˜æˆ {100, 100, 100}
```

**å»ºè®®ï¼šä¸€èˆ¬éƒ½ç”¨ `auto&`ï¼Œé¿å…å¤åˆ¶ï¼Œæ•ˆç‡é«˜**

---

## åã€è¿­ä»£å™¨éå†

### 10.1 å†™æ³•

```cpp
// å®Œæ•´å†™æ³•
for (map<string, int>::iterator it = scores.begin(); it != scores.end(); it++) {
    cout << it->first << " " << it->second << endl;
}

// ç®€åŒ–å†™æ³•
for (auto it = scores.begin(); it != scores.end(); it++) {
    cout << it->first << " " << it->second << endl;
}
```

### 10.2 èŒƒå›´ for vs è¿­ä»£å™¨ vs æ™®é€š for

**é€Ÿåº¦å¯¹æ¯”ï¼šæ²¡æœ‰åŒºåˆ«**

èŒƒå›´ for åº•å±‚å°±æ˜¯è¿­ä»£å™¨å®ç°çš„ï¼Œç¼–è¯‘å™¨ä¼šä¼˜åŒ–ï¼Œä¸‰ç§å†™æ³•æ€§èƒ½ç›¸åŒã€‚

**åŒºåˆ«åœ¨äºæ”¯æŒæ€§ï¼š**

| å®¹å™¨ | èƒ½ç”¨ä¸‹æ ‡å— | æ¨èå†™æ³• |
|------|-----------|---------|
| `vector` | èƒ½ | éƒ½è¡Œï¼ŒèŒƒå›´ for æœ€ç®€æ´ |
| `map` | ä¸èƒ½ | èŒƒå›´ for æˆ–è¿­ä»£å™¨ |
| `list` | ä¸èƒ½ | èŒƒå›´ for æˆ–è¿­ä»£å™¨ |
| `set` | ä¸èƒ½ | èŒƒå›´ for æˆ–è¿­ä»£å™¨ |

### 10.3 è¿­ä»£å™¨çš„ç‰¹æ®Šç”¨é€”ï¼šè¾¹éå†è¾¹åˆ é™¤

```cpp
for (auto it = scores.begin(); it != scores.end(); ) {
    if (it->second < 60) {
        it = scores.erase(it);  // åˆ é™¤å¹¶è¿”å›ä¸‹ä¸€ä¸ªä½ç½®
    } else {
        it++;
    }
}
```

èŒƒå›´ for åšä¸åˆ°è¿™ä¸ªï¼Œåˆ é™¤ä¼šå¯¼è‡´è¿­ä»£å™¨å¤±æ•ˆã€‚

---

## é™„ï¼šå¸¸ç”¨æ“ä½œé€ŸæŸ¥

| æ“ä½œ | ä»£ç  |
|------|------|
| æ‰“å¼€æ–‡ä»¶å†™å…¥ | `ofstream f("æ–‡ä»¶å");` |
| æ‰“å¼€æ–‡ä»¶è¯»å– | `ifstream f("æ–‡ä»¶å");` |
| è¿½åŠ æ¨¡å¼ | `ofstream f("æ–‡ä»¶å", ios::app);` |
| æ£€æŸ¥æ‰“å¼€æˆåŠŸ | `if (!f)` æˆ– `if (!f.is_open())` |
| å†™å…¥æ•°æ® | `f << æ•°æ®;` |
| è¯»å–å•è¯/æ•°å­— | `f >> å˜é‡;` |
| è¯»å–æ•´è¡Œ | `getline(f, å­—ç¬¦ä¸²);` |
| å…³é—­æ–‡ä»¶ | `f.close();` |
| å›åˆ°å¼€å¤´ | `f.seekg(0);` |
| æ¸…é™¤é”™è¯¯çŠ¶æ€ | `f.clear();` |

